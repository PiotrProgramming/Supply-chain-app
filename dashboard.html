<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TransForge™ - Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --success: #27ae60;
      --danger: #e74c3c;
      --light: #ecf0f1;
      --dark: #34495e;
      --gray: #95a5a6;
      --sidebar-width: 250px;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      color: #333;
      min-height: 100vh;
      display: flex;
    }
    
    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--primary);
      color: white;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      overflow-y: auto;
      z-index: 100;
    }
    
    .logo-section {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      text-align: center;
    }
    
    .logo-section h2 {
      margin: 0.5rem 0;
      font-weight: 600;
    }
    
    .company-name {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .nav-menu {
      list-style: none;
      padding: 1rem 0;
    }
    
    .nav-item {
      padding: 0.8rem 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      border-left: 3px solid transparent;
      position: relative;
    }
    
    .nav-item:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .nav-item.active {
      background: rgba(255,255,255,0.1);
      border-left: 3px solid var(--secondary);
    }
    
    .nav-item i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: 1rem;
      transition: all 0.3s ease;
    }
    
    .header {
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      border-radius: 8px;
    }
    
    .page-title {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .notification-badge {
      position: relative;
      cursor: pointer;
    }
    
    .badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.7rem;
    }
    
    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    
    /* Dashboard Grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }
    
    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 1.5rem;
      transition: transform 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
    }
    
    .stat-card {
      display: flex;
      flex-direction: column;
    }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 10px 0;
    }
    
    .stat-label {
      color: var(--gray);
      font-size: 0.9rem;
    }
    
    .stat-icon {
      align-self: flex-end;
      font-size: 2.5rem;
      opacity: 0.2;
    }
    
    /* Page Content Styles */
    .page-content {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 2rem;
    }
    
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    .btn {
      padding: 0.8rem 1.5rem;
      background: var(--secondary);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn:hover {
      background: #2980b9;
      transform: translateY(-2px);
    }
    
    .table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    
    .table th, .table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    
    .table th {
      background: #f8f9fa;
      font-weight: 600;
    }
    
    .table tr:hover {
      background: #f8f9fa;
    }
    
    .status-badge {
      padding: 0.3rem 0.6rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-available {
      background: #d5f5e3;
      color: #27ae60;
    }
    
    .status-on-delivery {
      background: #d1f2eb;
      color: #148f77;
    }
    
    .status-on-leave {
      background: #e6b0aa;
      color: #cb4335;
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--primary);
    }
    
    .form-control {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background: white;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      padding: 2rem;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .close-btn {
      font-size: 1.5rem;
      cursor: pointer;
      color: #999;
    }
    
    .close-btn:hover {
      color: #333;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo-section">
      <h2>TransForge™</h2>
      <div class="company-name" id="companyName">Your Company</div>
    </div>
    <ul class="nav-menu">
      <li class="nav-item active" data-page="dashboard">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
      </li>
      <li class="nav-item" data-page="drivers">
        <i class="fas fa-users"></i>
        <span>Drivers & Vehicles</span>
      </li>
      <li class="nav-item" data-page="tenders">
        <i class="fas fa-file-contract"></i>
        <span>Tenders</span>
      </li>
      <li class="nav-item" data-page="invoices">
        <i class="fas fa-file-invoice-dollar"></i>
        <span>Invoices</span>
      </li>
      <li class="nav-item" data-page="reports">
        <i class="fas fa-chart-bar"></i>
        <span>Reports</span>
      </li>
      <li class="nav-item" data-page="admin" id="adminMenuItem" style="display:none;">
        <i class="fas fa-cog"></i>
        <span>Administration</span>
      </li>
      <li class="nav-item" data-page="chat">
        <i class="fas fa-comments"></i>
        <span>Chat</span>
      </li>
      <li class="nav-item" data-page="notifications">
        <i class="fas fa-bell"></i>
        <span>Notifications</span>
      </li>
    </ul>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <div class="header">
      <div class="page-title" id="pageTitle">Dashboard</div>
      <div class="header-actions">
        <div class="notification-badge" onclick="loadPage('notifications')">
          <i class="fas fa-bell"></i>
          <span class="badge" id="notifCount">0</span>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <img src="https://ui-avatars.com/api/?name=User&background=2c3e50&color=fff" alt="User" class="avatar">
          <span id="userName">User</span>
        </div>
      </div>
    </div>

    <!-- Dynamic Page Content -->
    <div id="pageContent">
      <!-- Default Dashboard Content -->
      <div class="dashboard-grid">
        <div class="card stat-card">
          <div class="stat-value">0</div>
          <div class="stat-label">Total Drivers</div>
          <i class="fas fa-users stat-icon"></i>
        </div>
        <div class="card stat-card">
          <div class="stat-value">0</div>
          <div class="stat-label">Active Vehicles</div>
          <i class="fas fa-truck stat-icon"></i>
        </div>
        <div class="card stat-card">
          <div class="stat-value">0</div>
          <div class="stat-label">Pending Tenders</div>
          <i class="fas fa-file-contract stat-icon"></i>
        </div>
        <div class="card stat-card">
          <div class="stat-value">0</div>
          <div class="stat-label">Revenue</div>
          <i class="fas fa-dollar-sign stat-icon"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for forms -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">Modal</h3>
        <span class="close-btn" onclick="closeModal()">&times;</span>
      </div>
      <div id="modalBody">
        <!-- Form content will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    // Check if user is logged in
    document.addEventListener('DOMContentLoaded', () => {
      const user = localStorage.getItem('transforge_user');
      if (!user) {
        window.location.href = 'index.html';
        return;
      }
      
      const userData = JSON.parse(user);
      document.getElementById('userName').textContent = userData.email.split('@')[0];
      document.getElementById('companyName').textContent = userData.companyName;
      
      if (userData.isAdmin) {
        document.getElementById('adminMenuItem').style.display = 'block';
      }
      
      // Setup navigation
      setupNavigation();
      
      // Load dashboard data
      loadDashboardData();
    });

    function setupNavigation() {
      // Add click listeners to all nav items
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function() {
          // Remove active class from all items
          document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
          // Add active class to clicked item
          this.classList.add('active');
          // Load the page
          loadPage(this.dataset.page);
        });
      });
    }

    // Page content templates
    const pageTemplates = {
      dashboard: `
        <div class="dashboard-grid">
          <div class="card stat-card">
            <div class="stat-value">42</div>
            <div class="stat-label">Total Drivers</div>
            <i class="fas fa-users stat-icon"></i>
          </div>
          <div class="card stat-card">
            <div class="stat-value">28</div>
            <div class="stat-label">Active Vehicles</div>
            <i class="fas fa-truck stat-icon"></i>
          </div>
          <div class="card stat-card">
            <div class="stat-value">15</div>
            <div class="stat-label">Pending Tenders</div>
            <i class="fas fa-file-contract stat-icon"></i>
          </div>
          <div class="card stat-card">
            <div class="stat-value">€24,560</div>
            <div class="stat-label">Monthly Revenue</div>
            <i class="fas fa-dollar-sign stat-icon"></i>
          </div>
        </div>
      `,
      
      drivers: `
        <div class="page-content">
          <div class="page-header">
            <h2>Driver & Vehicle Management</h2>
            <button class="btn" onclick="openAddDriverModal()">
              <i class="fas fa-plus"></i> Add Driver
            </button>
          </div>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Status</th>
                  <th>Vehicle</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="driversTable">
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      `,
      
      tenders: `
        <div class="page-content">
          <div class="page-header">
            <h2>Tender Management</h2>
            <button class="btn" onclick="openAddTenderModal()">
              <i class="fas fa-plus"></i> Add Tender
            </button>
          </div>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Reference</th>
                  <th>Client</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tendersTable">
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      `,
      
      invoices: `
        <div class="page-content">
          <div class="page-header">
            <h2>Invoice Management</h2>
            <button class="btn" onclick="openAddInvoiceModal()">
              <i class="fas fa-plus"></i> Create Invoice
            </button>
          </div>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Invoice #</th>
                  <th>Client</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="invoicesTable">
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      `,
      
      reports: `
        <div class="page-content">
          <div class="page-header">
            <h2>Reports & Analytics</h2>
            <div>
              <button class="btn" onclick="exportToPDF()">
                <i class="fas fa-file-pdf"></i> Export PDF
              </button>
              <button class="btn" onclick="exportToExcel()">
                <i class="fas fa-file-excel"></i> Export Excel
              </button>
            </div>
          </div>
          <p>EUR/Km per driver analysis</p>
          <p>Vehicle load percentage metrics</p>
          <p>Monthly revenue breakdown with pending and overdue invoices</p>
          <p>Tender status distribution charts</p>
          <p>Driver performance with on-time deliveries and fuel efficiency</p>
        </div>
      `,
      
      admin: `
        <div class="page-content">
          <div class="page-header">
            <h2>Administration Tools</h2>
            <button class="btn" onclick="openAddUserModal()">
              <i class="fas fa-plus"></i> Add User
            </button>
          </div>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="usersTable">
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
          <div style="margin-top: 2rem;">
            <h3>Corporate Hierarchy</h3>
            <p>Manage employee reporting structure</p>
            <button class="btn" onclick="openHierarchyModal()">
              <i class="fas fa-sitemap"></i> Edit Hierarchy
            </button>
          </div>
        </div>
      `,
      
      chat: `
        <div class="page-content">
          <div class="page-header">
            <h2>Team Chat</h2>
            <button class="btn" onclick="openGroupChatModal()">
              <i class="fas fa-users"></i> New Group
            </button>
          </div>
          <div style="display: flex; height: 500px;">
            <div style="width: 30%; border-right: 1px solid #eee; padding: 1rem;">
              <h4>Contacts</h4>
              <div id="contactsList">
                <!-- Will be populated by JavaScript -->
              </div>
            </div>
            <div style="flex: 1; padding: 1rem;">
              <div id="chatMessages" style="height: 80%; overflow-y: auto; border: 1px solid #eee; padding: 1rem; margin-bottom: 1rem;">
                <!-- Messages will appear here -->
              </div>
              <div style="display: flex;">
                <input type="text" placeholder="Type a message..." style="flex: 1; padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px 0 0 5px;">
                <button class="btn" style="border-radius: 0 5px 5px 0;">Send</button>
              </div>
            </div>
          </div>
        </div>
      `,
      
      notifications: `
        <div class="page-content">
          <div class="page-header">
            <h2>Notifications</h2>
            <button class="btn" onclick="markAllAsRead()">
              <i class="fas fa-check-double"></i> Mark All Read
            </button>
          </div>
          <div id="notificationsList">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>
      `
    };

    function loadPage(page) {
      const pageContent = document.getElementById('pageContent');
      const pageTitle = document.getElementById('pageTitle');
      
      // Update page title
      const titles = {
        dashboard: 'Dashboard',
        drivers: 'Drivers & Vehicles',
        tenders: 'Tenders',
        invoices: 'Invoices',
        reports: 'Reports',
        admin: 'Administration',
        chat: 'Chat',
        notifications: 'Notifications'
      };
      
      pageTitle.textContent = titles[page] || 'Dashboard';
      
      // Load page content
      pageContent.innerHTML = pageTemplates[page] || pageTemplates.dashboard;
      
      // Load data for the page
      if (page === 'drivers') {
        loadDrivers();
      } else if (page === 'tenders') {
        loadTenders();
      } else if (page === 'invoices') {
        loadInvoices();
      } else if (page === 'admin') {
        loadUsers();
      } else if (page === 'notifications') {
        loadNotifications();
      }
    }

    // Dashboard functions
    function loadDashboardData() {
      // In a real app, this would fetch from your data storage
      // For now, we'll just show sample data
    }

    // Driver functions
    function loadDrivers() {
      const drivers = [
        { id: 1, name: 'John Smith', status: 'available', vehicle: 'Mercedes Actros' },
        { id: 2, name: 'Mike Johnson', status: 'on-delivery', vehicle: 'Volvo FH16' },
        { id: 3, name: 'Sarah Wilson', status: 'on-leave', vehicle: 'Scania R500' }
      ];
      
      const tableBody = document.getElementById('driversTable');
      tableBody.innerHTML = drivers.map(driver => `
        <tr>
          <td>${driver.name}</td>
          <td><span class="status-badge status-${driver.status.replace('-', '')}">${driver.status.replace('-', ' ')}</span></td>
          <td>${driver.vehicle}</td>
          <td>
            <button class="btn btn-sm" onclick="editDriver(${driver.id})">Edit</button>
            <button class="btn btn-sm" onclick="deleteDriver(${driver.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function openAddDriverModal() {
      document.getElementById('modalTitle').textContent = 'Add Driver';
      document.getElementById('modalBody').innerHTML = `
        <form onsubmit="saveDriver(event)">
          <div class="form-group">
            <label>Name</label>
            <input type="text" id="driverName" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Status</label>
            <select id="driverStatus" class="form-control" required>
              <option value="available">Available</option>
              <option value="on-delivery">On Delivery</option>
              <option value="on-leave">On Leave</option>
            </select>
          </div>
          <div class="form-group">
            <label>Vehicle</label>
            <select id="driverVehicle" class="form-control">
              <option value="">Unassigned</option>
              <option value="Mercedes Actros">Mercedes Actros</option>
              <option value="Volvo FH16">Volvo FH16</option>
              <option value="Scania R500">Scania R500</option>
            </select>
          </div>
          <div class="form-group">
            <label>License Number</label>
            <input type="text" id="driverLicense" class="form-control">
          </div>
          <div class="form-group">
            <label>License Expiry</label>
            <input type="date" id="driverLicenseExpiry" class="form-control">
          </div>
          <div style="text-align: right;">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            <button type="submit" class="btn">Save Driver</button>
          </div>
        </form>
      `;
      document.getElementById('modal').style.display = 'flex';
    }

    function saveDriver(event) {
      event.preventDefault();
      const name = document.getElementById('driverName').value;
      const status = document.getElementById('driverStatus').value;
      const vehicle = document.getElementById('driverVehicle').value;
      
      console.log('Saving driver:', { name, status, vehicle });
      
      closeModal();
      loadDrivers(); // Refresh the list
    }

    function editDriver(id) {
      openAddDriverModal(); // In a real app, this would be pre-filled with data
      document.getElementById('modalTitle').textContent = 'Edit Driver';
    }

    function deleteDriver(id) {
      if (confirm('Are you sure you want to delete this driver?')) {
        console.log('Deleting driver:', id);
        loadDrivers(); // Refresh the list
      }
    }

    // Tender functions
    function loadTenders() {
      const tenders = [
        { id: 1, reference: 'TDR-001', client: 'ABC Logistics', status: 'pending' },
        { id: 2, reference: 'TDR-002', client: 'XYZ Transport', status: 'in-delivery' },
        { id: 3, reference: 'TDR-003', client: 'Global Freight', status: 'completed' }
      ];
      
      const tableBody = document.getElementById('tendersTable');
      tableBody.innerHTML = tenders.map(tender => `
        <tr>
          <td>${tender.reference}</td>
          <td>${tender.client}</td>
          <td><span class="status-badge status-${tender.status}">${tender.status.replace('-', ' ')}</span></td>
          <td>
            <button class="btn btn-sm" onclick="editTender(${tender.id})">Edit</button>
            <button class="btn btn-sm" onclick="deleteTender(${tender.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function openAddTenderModal() {
      document.getElementById('modalTitle').textContent = 'Add Tender';
      document.getElementById('modalBody').innerHTML = `
        <form onsubmit="saveTender(event)">
          <div class="form-group">
            <label>Reference</label>
            <input type="text" id="tenderReference" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Client</label>
            <input type="text" id="tenderClient" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Loading Date</label>
            <input type="date" id="tenderLoadingDate" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Loading Place</label>
            <input type="text" id="tenderLoadingPlace" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Unloading Date</label>
            <input type="date" id="tenderUnloadingDate" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Unloading Place</label>
            <input type="text" id="tenderUnloadingPlace" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Weight (tons)</label>
            <input type="number" id="tenderWeight" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Price</label>
            <input type="number" id="tenderPrice" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Currency</label>
            <select id="tenderCurrency" class="form-control" required>
              <option value="EUR">EUR</option>
              <option value="USD">USD</option>
              <option value="GBP">GBP</option>
            </select>
          </div>
          <div class="form-group">
            <label>Status</label>
            <select id="tenderStatus" class="form-control" required>
              <option value="pending">Pending</option>
              <option value="in-delivery">In Delivery</option>
              <option value="completed">Completed</option>
              <option value="cancelled">Cancelled</option>
              <option value="sold">Sold</option>
            </select>
          </div>
          <div style="text-align: right;">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            <button type="submit" class="btn">Save Tender</button>
          </div>
        </form>
      `;
      document.getElementById('modal').style.display = 'flex';
    }

    function saveTender(event) {
      event.preventDefault();
      const reference = document.getElementById('tenderReference').value;
      const client = document.getElementById('tenderClient').value;
      const status = document.getElementById('tenderStatus').value;
      
      console.log('Saving tender:', { reference, client, status });
      
      closeModal();
      loadTenders(); // Refresh the list
    }

    function editTender(id) {
      openAddTenderModal(); // In a real app, this would be pre-filled with data
      document.getElementById('modalTitle').textContent = 'Edit Tender';
    }

    function deleteTender(id) {
      if (confirm('Are you sure you want to delete this tender?')) {
        console.log('Deleting tender:', id);
        loadTenders(); // Refresh the list
      }
    }

    // Invoice functions
    function loadInvoices() {
      const invoices = [
        { id: 1, number: 'INV-001', client: 'ABC Logistics', amount: 2500, status: 'paid' },
        { id: 2, number: 'INV-002', client: 'XYZ Transport', amount: 3200, status: 'pending' },
        { id: 3, number: 'INV-003', client: 'Global Freight', amount: 1800, status: 'overdue' }
      ];
      
      const tableBody = document.getElementById('invoicesTable');
      tableBody.innerHTML = invoices.map(invoice => `
        <tr>
          <td>${invoice.number}</td>
          <td>${invoice.client}</td>
          <td>€${invoice.amount}</td>
          <td><span class="status-badge status-${invoice.status}">${invoice.status.replace('-', ' ')}</span></td>
          <td>
            <button class="btn btn-sm" onclick="editInvoice(${invoice.id})">Edit</button>
            <button class="btn btn-sm" onclick="deleteInvoice(${invoice.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function openAddInvoiceModal() {
      document.getElementById('modalTitle').textContent = 'Create Invoice';
      document.getElementById('modalBody').innerHTML = `
        <form onsubmit="saveInvoice(event)">
          <div class="form-group">
            <label>Invoice Number</label>
            <input type="text" id="invoiceNumber" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Client</label>
            <input type="text" id="invoiceClient" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Amount</label>
            <input type="number" id="invoiceAmount" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Date</label>
            <input type="date" id="invoiceDate" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Due Days</label>
            <input type="number" id="invoiceDueDays" class="form-control" value="30" required>
          </div>
          <div class="form-group">
            <label>Reminder Days</label>
            <input type="number" id="invoiceReminderDays" class="form-control" value="7" required>
          </div>
          <div style="text-align: right;">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            <button type="submit" class="btn">Save Invoice</button>
          </div>
        </form>
      `;
      document.getElementById('modal').style.display = 'flex';
    }

    function saveInvoice(event) {
      event.preventDefault();
      const number = document.getElementById('invoiceNumber').value;
      const client = document.getElementById('invoiceClient').value;
      const amount = document.getElementById('invoiceAmount').value;
      
      console.log('Saving invoice:', { number, client, amount });
      
      closeModal();
      loadInvoices(); // Refresh the list
    }

    function editInvoice(id) {
      openAddInvoiceModal(); // In a real app, this would be pre-filled with data
      document.getElementById('modalTitle').textContent = 'Edit Invoice';
    }

    function deleteInvoice(id) {
      if (confirm('Are you sure you want to delete this invoice?')) {
        console.log('Deleting invoice:', id);
        loadInvoices(); // Refresh the list
      }
    }

    // Admin functions
    function loadUsers() {
      const users = [
        { id: 1, name: 'John Smith', email: 'john@company.com', role: 'admin' },
        { id: 2, name: 'Mike Johnson', email: 'mike@company.com', role: 'driver' },
        { id: 3, name: 'Sarah Wilson', email: 'sarah@company.com', role: 'manager' }
      ];
      
      const tableBody = document.getElementById('usersTable');
      tableBody.innerHTML = users.map(user => `
        <tr>
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td><span class="status-badge" style="background: #9b59b6; color: white;">${user.role}</span></td>
          <td>
            <button class="btn btn-sm" onclick="editUser(${user.id})">Edit</button>
            <button class="btn btn-sm" onclick="deleteUser(${user.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function openAddUserModal() {
      document.getElementById('modalTitle').textContent = 'Add User';
      document.getElementById('modalBody').innerHTML = `
        <form onsubmit="saveUser(event)">
          <div class="form-group">
            <label>Name</label>
            <input type="text" id="userName" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="userEmail" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" id="userPassword" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Role</label>
            <select id="userRole" class="form-control" required>
              <option value="admin">Admin</option>
              <option value="manager">Manager</option>
              <option value="driver">Driver</option>
            </select>
          </div>
          <div class="form-group">
            <label>Reports To</label>
            <select id="userReportsTo" class="form-control">
              <option value="">None</option>
              <option value="1">John Smith (Admin)</option>
              <option value="3">Sarah Wilson (Manager)</option>
            </select>
          </div>
          <div style="text-align: right;">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            <button type="submit" class="btn">Save User</button>
          </div>
        </form>
      `;
      document.getElementById('modal').style.display = 'flex';
    }

    function saveUser(event) {
      event.preventDefault();
      const name = document.getElementById('userName').value;
      const email = document.getElementById('userEmail').value;
      const role = document.getElementById('userRole').value;
      
      console.log('Saving user:', { name, email, role });
      
      closeModal();
      loadUsers(); // Refresh the list
    }

    function editUser(id) {
      openAddUserModal(); // In a real app, this would be pre-filled with data
      document.getElementById('modalTitle').textContent = 'Edit User';
    }

    function deleteUser(id) {
      if (confirm('Are you sure you want to delete this user?')) {
        console.log('Deleting user:', id);
        loadUsers(); // Refresh the list
      }
    }

    function openHierarchyModal() {
      alert('Hierarchy editor would open here');
    }

    // Chat functions
    function loadChat() {
      const contacts = [
        { id: 1, name: 'John Smith', role: 'Admin', reportsTo: 'None' },
        { id: 2, name: 'Mike Johnson', role: 'Driver', reportsTo: 'Sarah Wilson' },
        { id: 3, name: 'Sarah Wilson', role: 'Manager', reportsTo: 'John Smith' }
      ];
      
      const contactsList = document.getElementById('contactsList');
      contactsList.innerHTML = contacts.map(contact => `
        <div style="padding: 0.5rem; border-bottom: 1px solid #eee; cursor: pointer;" onclick="selectContact(${contact.id})">
          <div><strong>${contact.name}</strong> (${contact.role})</div>
          <div style="font-size: 0.8rem; color: #666;">Reports to: ${contact.reportsTo}</div>
        </div>
      `).join('');
    }

    function selectContact(id) {
      console.log('Selected contact:', id);
      // In a real app, this would load messages for the selected contact
    }

    function openGroupChatModal() {
      alert('Group chat creation would open here');
    }

    // Notifications functions
    function loadNotifications() {
      const notifications = [
        { id: 1, message: 'Driver license expiring soon', time: '2 hours ago', type: 'warning' },
        { id: 2, message: 'Invoice payment overdue', time: '5 hours ago', type: 'danger' },
        { id: 3, message: 'New tender assigned', time: '1 day ago', type: 'info' }
      ];
      
      const notificationsList = document.getElementById('notificationsList');
      notificationsList.innerHTML = notifications.map(notif => `
        <div style="padding: 1rem; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
          <div>
            <div><strong>${notif.message}</strong></div>
            <div style="font-size: 0.8rem; color: #666;">${notif.time}</div>
          </div>
          <button class="btn btn-sm" onclick="markAsRead(${notif.id})">Mark Read</button>
        </div>
      `).join('');
    }

    function markAsRead(id) {
      console.log('Marked notification as read:', id);
      loadNotifications(); // Refresh the list
    }

    function markAllAsRead() {
      if (confirm('Mark all notifications as read?')) {
        console.log('Marked all notifications as read');
        loadNotifications(); // Refresh the list
      }
    }

    // Report functions
    function exportToPDF() {
      alert('Exporting to PDF...');
      // In a real app, this would use jsPDF
    }

    function exportToExcel() {
      alert('Exporting to Excel...');
      // In a real app, this would use SheetJS
    }

    // Modal functions
    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('modal');
      if (event.target === modal) {
        closeModal();
      }
    }

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeModal();
      }
    });
  </script>
</body>
</html>
