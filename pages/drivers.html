<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TransForge™ - Drivers & Vehicles</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
      --light: #ecf0f1;
      --dark: #34495e;
      --gray: #95a5a6;
      --sidebar-width: 250px;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      color: #333;
      min-height: 100vh;
      display: flex;
    }
    
    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--primary);
      color: white;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      overflow-y: auto;
      z-index: 100;
    }
    
    .logo-section {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      text-align: center;
    }
    
    .logo-section h2 {
      margin: 0.5rem 0;
      font-weight: 600;
    }
    
    .company-name {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .nav-menu {
      list-style: none;
      padding: 1rem 0;
    }
    
    .nav-item {
      padding: 0.8rem 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      border-left: 3px solid transparent;
      position: relative;
    }
    
    .nav-item:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .nav-item.active {
      background: rgba(255,255,255,0.1);
      border-left: 3px solid var(--secondary);
    }
    
    .nav-item i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: 1rem;
      transition: all 0.3s ease;
    }
    
    .header {
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      border-radius: 8px;
    }
    
    .page-title {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .notification-badge {
      position: relative;
      cursor: pointer;
    }
    
    .badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.7rem;
    }
    
    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    
    /* Dashboard Grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }
    
    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 1.5rem;
      transition: transform 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
    }
    
    .stat-card {
      display: flex;
      flex-direction: column;
    }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 10px 0;
    }
    
    .stat-label {
      color: var(--gray);
      font-size: 0.9rem;
    }
    
    .stat-icon {
      align-self: flex-end;
      font-size: 2.5rem;
      opacity: 0.2;
    }
    
    /* Page Content Styles */
    .page-content {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 2rem;
    }
    
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    .btn {
      padding: 0.8rem 1.5rem;
      background: var(--secondary);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn:hover {
      background: #2980b9;
      transform: translateY(-2px);
    }
    
    .btn-success {
      background: var(--success);
    }
    
    .btn-warning {
      background: var(--warning);
    }
    
    .btn-danger {
      background: var(--danger);
    }
    
    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }
    
    .table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    
    .table th, .table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    
    .table th {
      background: #f8f9fa;
      font-weight: 600;
    }
    
    .table tr:hover {
      background: #f8f9fa;
    }
    
    .status-badge {
      padding: 0.3rem 0.6rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-available {
      background: #d5f5e3;
      color: #27ae60;
    }
    
    .status-on-delivery {
      background: #d1f2eb;
      color: #148f77;
    }
    
    .status-on-leave {
      background: #e6b0aa;
      color: #cb4335;
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--primary);
    }
    
    .form-control {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background: white;
      border-radius: 10px;
      width: 90%;
      max-width: 800px;
      padding: 2rem;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .close-btn {
      font-size: 1.5rem;
      cursor: pointer;
      color: #999;
    }
    
    .close-btn:hover {
      color: #333;
    }
    
    .tab-navigation {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 1.5rem;
    }
    
    .tab {
      padding: 0.8rem 1.5rem;
      cursor: pointer;
      border-bottom: 3px solid transparent;
    }
    
    .tab.active {
      border-bottom: 3px solid var(--secondary);
      font-weight: 600;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .card-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .card-item {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #eee;
    }
    
    .card-item h4 {
      margin-bottom: 0.5rem;
    }
    
    .driver-list, .vehicle-list {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .driver-item, .vehicle-item {
      width: 200px;
      padding: 1rem;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .driver-item:hover, .vehicle-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .driver-status {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }
    
    .vehicle-capacity {
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: 0.5rem;
    }
    
    .expiry-warning {
      color: var(--warning);
      font-weight: 600;
    }
    
    .expiry-danger {
      color: var(--danger);
      font-weight: 600;
    }
    
    .notification-settings {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
    }
    
    .notification-settings h4 {
      margin-bottom: 1rem;
    }
    
    .notification-row {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .notification-row label {
      flex: 1;
    }
    
    .notification-row input {
      width: 80px;
    }
    
    .drag-area {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      margin-top: 1rem;
      background: #f8f9fa;
    }
    
    .drag-area.highlight {
      border-color: var(--secondary);
      background: rgba(52, 152, 219, 0.05);
    }
    
    .card-type {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #eee;
    }
    
    .card-type-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .tabs-container {
      display: flex;
      margin-bottom: 1.5rem;
    }
    
    .tab-button {
      flex: 1;
      padding: 1rem;
      text-align: center;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    
    .tab-button.active {
      border-bottom: 3px solid var(--secondary);
      font-weight: 600;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo-section">
      <h2>TransForge™</h2>
      <div class="company-name" id="companyName">Your Company</div>
    </div>
    <ul class="nav-menu">
      <li class="nav-item" data-page="dashboard">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
      </li>
      <li class="nav-item active" data-page="drivers">
        <i class="fas fa-users"></i>
        <span>Drivers & Vehicles</span>
      </li>
      <li class="nav-item" data-page="tenders">
        <i class="fas fa-file-contract"></i>
        <span>Tenders</span>
      </li>
      <li class="nav-item" data-page="invoices">
        <i class="fas fa-file-invoice-dollar"></i>
        <span>Invoices</span>
      </li>
      <li class="nav-item" data-page="reports">
        <i class="fas fa-chart-bar"></i>
        <span>Reports</span>
      </li>
      <li class="nav-item" data-page="admin" id="adminMenuItem" style="display:none;">
        <i class="fas fa-cog"></i>
        <span>Administration</span>
      </li>
      <li class="nav-item" data-page="chat">
        <i class="fas fa-comments"></i>
        <span>Chat</span>
      </li>
      <li class="nav-item" data-page="notifications">
        <i class="fas fa-bell"></i>
        <span>Notifications</span>
      </li>
    </ul>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <div class="header">
      <div class="page-title">Drivers & Vehicles</div>
      <div class="header-actions">
        <div class="notification-badge" onclick="loadPage('notifications')">
          <i class="fas fa-bell"></i>
          <span class="badge" id="notifCount">0</span>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <img src="https://ui-avatars.com/api/?name=User&background=2c3e50&color=fff" alt="User" class="avatar">
          <span id="userName">User</span>
        </div>
      </div>
    </div>

    <!-- Page Content -->
    <div class="page-content">
      <div class="page-header">
        <h2>Driver & Vehicle Management</h2>
        <div>
          <button class="btn" onclick="openAddDriverModal()">
            <i class="fas fa-user-plus"></i> Add Driver
          </button>
          <button class="btn" style="margin-left: 0.5rem;" onclick="openAddVehicleModal()">
            <i class="fas fa-truck"></i> Add Vehicle
          </button>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs-container">
        <div class="tab-button active" data-tab="drivers">Drivers</div>
        <div class="tab-button" data-tab="vehicles">Vehicles</div>
        <div class="tab-button" data-tab="cards">Card Types</div>
      </div>

      <!-- Drivers Tab -->
      <div class="tab-content active" id="drivers-tab">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Assigned Vehicle</th>
                <th>License Expiry</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="driversTable">
              <!-- Will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
        
        <h3 style="margin-top: 2rem; margin-bottom: 1rem;">Driver Assignment</h3>
        <div class="drag-area" id="assignmentArea">
          <p>Drag and drop drivers to vehicles for assignment</p>
          <div style="display: flex; gap: 2rem; margin-top: 1rem;">
            <div class="driver-list" id="availableDrivers"></div>
            <div class="vehicle-list" id="availableVehicles"></div>
          </div>
        </div>
      </div>

      <!-- Vehicles Tab -->
      <div class="tab-content" id="vehicles-tab">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Registration</th>
                <th>Type</th>
                <th>Max Load (tons)</th>
                <th>Insurance Expiry</th>
                <th>Inspection Expiry</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="vehiclesTable">
              <!-- Will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
        
        <div class="notification-settings">
          <h4>Expiry Notification Settings</h4>
          <div class="notification-row">
            <label>Notify before insurance expiry (days):</label>
            <input type="number" id="insuranceNotificationDays" value="30" min="1">
          </div>
          <div class="notification-row">
            <label>Notify before inspection expiry (days):</label>
            <input type="number" id="inspectionNotificationDays" value="14" min="1">
          </div>
          <div style="text-align: right; margin-top: 1rem;">
            <button class="btn" onclick="saveNotificationSettings()">Save Settings</button>
          </div>
        </div>
      </div>

      <!-- Card Types Tab -->
      <div class="tab-content" id="cards-tab">
        <div class="form-group">
          <label>New Card Type</label>
          <div style="display: flex; gap: 0.5rem;">
            <input type="text" id="newCardType" class="form-control" placeholder="e.g., Fuel Card, Toll Card">
            <button class="btn" onclick="addCardType()">Add Type</button>
          </div>
        </div>
        
        <h3 style="margin-top: 2rem; margin-bottom: 1rem;">Existing Card Types</h3>
        <div id="cardTypesList">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for forms -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">Modal</h3>
        <span class="close-btn" onclick="closeModal()">&times;</span>
      </div>
      <div id="modalBody">
        <!-- Form content will be loaded here -->
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.js"></script>
  <script>
    // Initialize drag and drop
    document.addEventListener('DOMContentLoaded', () => {
      // Setup navigation
      setupNavigation();
      
      // Load initial data
      loadDrivers();
      loadVehicles();
      loadCardTypes();
      
      // Initialize tabs
      setupTabs();
      
      // Initialize drag and drop for assignment
      initDragAndDrop();
      
      // Load notification settings
      loadNotificationSettings();
    });

    function setupNavigation() {
      // Add click listeners to all nav items
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function() {
          // Remove active class from all items
          document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
          // Add active class to clicked item
          this.classList.add('active');
          // Load the page
          loadPage(this.dataset.page);
        });
      });
    }

    function loadPage(page) {
      // In a real app, this would load the appropriate HTML partial
      // For now, we'll just show an alert
      console.log(`Loading page: ${page}`);
      // Actual implementation would fetch and inject HTML
    }

    // Tab functionality
    function setupTabs() {
      document.querySelectorAll('.tab-button').forEach(tab => {
        tab.addEventListener('click', () => {
          // Remove active class from all tabs
          document.querySelectorAll('.tab-button').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          
          // Add active class to clicked tab
          tab.classList.add('active');
          
          // Show corresponding content
          const tabName = tab.dataset.tab;
          document.getElementById(`${tabName}-tab`).classList.add('active');
        });
      });
    }

    // Drag and drop functionality
    function initDragAndDrop() {
      dragula([document.getElementById('availableDrivers'), document.getElementById('availableVehicles')], {
        moves: function (el, source, handle, sibling) {
          return true;
        },
        accepts: function (el, target, source, sibling) {
          // Only allow dragging from one list to the other
          return target !== source;
        }
      }).on('drop', function (el, target, source, sibling) {
        const driverId = el.dataset.driverId;
        const vehicleId = target === document.getElementById('availableVehicles') ? 
                         el.parentElement.dataset.vehicleId : 
                         el.parentElement.dataset.driverId;
        
        if (target === document.getElementById('availableVehicles')) {
          // Driver dropped on vehicle - assign driver to vehicle
          assignDriverToVehicle(driverId, vehicleId);
        } else {
          // Vehicle dropped on driver - assign vehicle to driver
          assignDriverToVehicle(driverId, vehicleId);
        }
        
        // Refresh the lists
        loadDrivers();
        loadVehicles();
      });
    }

    // Driver Management
    function loadDrivers() {
      const drivers = [
        { id: 1, name: 'John Smith', status: 'available', vehicle: 'ABC-123', licenseExpiry: '2024-05-15' },
        { id: 2, name: 'Mike Johnson', status: 'on-delivery', vehicle: 'XYZ-789', licenseExpiry: '2024-08-20' },
        { id: 3, name: 'Sarah Wilson', status: 'on-leave', vehicle: '', licenseExpiry: '2024-03-10' }
      ];
      
      const tableBody = document.getElementById('driversTable');
      tableBody.innerHTML = drivers.map(driver => `
        <tr>
          <td>${driver.name}</td>
          <td><span class="status-badge status-${driver.status.replace('-', '')}">${driver.status.replace('-', ' ')}</span></td>
          <td>${driver.vehicle || 'Unassigned'}</td>
          <td>${formatDate(driver.licenseExpiry)}</td>
          <td>
            <button class="btn btn-sm" onclick="openEditDriverModal(${driver.id})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteDriver(${driver.id})">Delete</button>
          </td>
        </tr>
      `).join('');
      
      // Update drag area
      updateDragArea();
    }

    function updateDragArea() {
      const drivers = [
        { id: 1, name: 'John Smith', status: 'available', vehicle: 'ABC-123', licenseExpiry: '2024-05-15' },
        { id: 2, name: 'Mike Johnson', status: 'on-delivery', vehicle: 'XYZ-789', licenseExpiry: '2024-08-20' },
        { id: 3, name: 'Sarah Wilson', status: 'on-leave', vehicle: '', licenseExpiry: '2024-03-10' }
      ];
      
      const vehicles = [
        { id: 1, reg: 'ABC-123', type: 'Truck', maxLoad: 20, insuranceExpiry: '2024-06-01', inspectionExpiry: '2024-05-15' },
        { id: 2, reg: 'XYZ-789', type: 'Van', maxLoad: 5, insuranceExpiry: '2024-09-15', inspectionExpiry: '2024-08-30' },
        { id: 3, reg: 'DEF-456', type: 'Truck', maxLoad: 15, insuranceExpiry: '2024-04-10', inspectionExpiry: '2024-03-25' }
      ];
      
      // Available drivers
      const availableDrivers = document.getElementById('availableDrivers');
      availableDrivers.innerHTML = drivers.filter(d => d.status === 'available').map(driver => `
        <div class="driver-item" data-driver-id="${driver.id}">
          <h4>${driver.name}</h4>
          <div class="driver-status status-${driver.status.replace('-', '')}">${driver.status.replace('-', ' ')}</div>
          <div>License: ${formatDate(driver.licenseExpiry)}</div>
        </div>
      `).join('');
      
      // Available vehicles
      const availableVehicles = document.getElementById('availableVehicles');
      availableVehicles.innerHTML = vehicles.map(vehicle => `
        <div class="vehicle-item" data-vehicle-id="${vehicle.id}">
          <h4>${vehicle.reg}</h4>
          <div class="vehicle-capacity">${vehicle.type} - ${vehicle.maxLoad} tons</div>
          <div>Insurance: ${formatDate(vehicle.insuranceExpiry)}</div>
          <div>Inspection: ${formatDate(vehicle.inspectionExpiry)}</div>
        </div>
      `).join('');
    }

    function assignDriverToVehicle(driverId, vehicleId) {
      console.log(`Assigning driver ${driverId} to vehicle ${vehicleId}`);
      // In a real app, this would update the database
      alert(`Driver assigned to vehicle! Driver ID: ${driverId}, Vehicle ID: ${vehicleId}`);
    }

    function openAddDriverModal() {
      document.getElementById('modalTitle').textContent = 'Add Driver';
      document.getElementById('modalBody').innerHTML = `
        <div class="tab-navigation">
          <div class="tab active" data-tab="driver-info">Driver Info</div>
          <div class="tab" data-tab="driver-cards">Cards</div>
        </div>
        
        <div class="tab-content active" id="driver-info">
          <form onsubmit="saveDriver(event)">
            <div class="form-group">
              <label>Name</label>
              <input type="text" id="driverName" class="form-control" required>
            </div>
            <div class="form-group">
              <label>Status</label>
              <select id="driverStatus" class="form-control" required>
                <option value="available">Available</option>
                <option value="on-delivery">On Delivery</option>
                <option value="on-leave">On Leave</option>
              </select>
            </div>
            <div class="form-group">
              <label>License Number</label>
              <input type="text" id="driverLicense" class="form-control" required>
            </div>
            <div class="form-group">
              <label>License Expiry</label>
              <input type="date" id="driverLicenseExpiry" class="form-control" required>
            </div>
            <div class="form-group">
              <label>Assigned Vehicle</label>
              <select id="driverVehicle" class="form-control">
                <option value="">Unassigned</option>
                <option value="1">ABC-123 (Truck)</option>
                <option value="2">XYZ-789 (Van)</option>
                <option value="3">DEF-456 (Truck)</option>
              </select>
            </div>
            <div style="text-align: right;">
              <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
              <button type="submit" class="btn">Save Driver</button>
            </div>
          </form>
        </div>
        
        <div class="tab-content" id="driver-cards">
          <h3>Driver Cards</h3>
          <div id="driverCardsList">
            <p>No cards assigned yet. Add cards after saving the driver.</p>
          </div>
          <div style="text-align: right; margin-top: 1rem;">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">Close</button>
          </div>
        </div>
      `;
      document.getElementById('modal').style.display = 'flex';
      
      // Setup tab navigation
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          
          tab.classList.add('active');
          document.getElementById(tab.dataset.tab).classList.add('active');
        });
      });
    }

    function openEditDriverModal(id) {
      // In a real app, this would fetch the driver data
      openAddDriverModal();
      document.getElementById('modalTitle').textContent = 'Edit Driver';
      document.getElementById('driverName').value = 'John Smith';
      document.getElementById('driverStatus').value = 'available';
      document.getElementById('driverLicense').value = 'DL123456';
      document.getElementById('driverLicenseExpiry').value = '2024-05-15';
      document.getElementById('driverVehicle').value = '1';
    }

    function saveDriver(event) {
      event.preventDefault();
      const name = document.getElementById('driverName').value;
      const status = document.getElementById('driverStatus').value;
      const license = document.getElementById('driverLicense').value;
      const licenseExpiry = document.getElementById('driverLicenseExpiry').value;
      const vehicle = document.getElementById('driverVehicle').value;
      
      console.log('Saving driver:', { name, status, license, licenseExpiry, vehicle });
      
      closeModal();
      loadDrivers();
      updateDragArea();
    }

    function deleteDriver(id) {
      if (confirm('Are you sure you want to delete this driver?')) {
        console.log('Deleting driver:', id);
        loadDrivers();
        updateDragArea();
      }
    }

    // Vehicle Management
    function loadVehicles() {
      const vehicles = [
        { id: 1, reg: 'ABC-123', type: 'Truck', maxLoad: 20, insuranceExpiry: '2024-06-01', inspectionExpiry: '2024-05-15' },
        { id: 2, reg: 'XYZ-789', type: 'Van', maxLoad: 5, insuranceExpiry: '2024-09-15', inspectionExpiry: '2024-08-30' },
        { id: 3, reg: 'DEF-456', type: 'Truck', maxLoad: 15, insuranceExpiry: '2024-04-10', inspectionExpiry: '2024-03-25' }
      ];
      
      const tableBody = document.getElementById('vehiclesTable');
      tableBody.innerHTML = vehicles.map(vehicle => `
        <tr>
          <td>${vehicle.reg}</td>
          <td>${vehicle.type}</td>
          <td>${vehicle.maxLoad} tons</td>
          <td class="${getExpiryClass(vehicle.insuranceExpiry)}">${formatDate(vehicle.insuranceExpiry)}</td>
          <td class="${getExpiryClass(vehicle.inspectionExpiry)}">${formatDate(vehicle.inspectionExpiry)}</td>
          <td>
            <button class="btn btn-sm" onclick="openEditVehicleModal(${vehicle.id})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteVehicle(${vehicle.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function getExpiryClass(dateStr) {
      const today = new Date();
      const expiry = new Date(dateStr);
      const diffTime = expiry - today;
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      if (diffDays < 0) return 'expiry-danger';
      if (diffDays <= 14) return 'expiry-warning';
      return '';
    }

    function openAddVehicleModal() {
      document.getElementById('modalTitle').textContent = 'Add Vehicle';
      document.getElementById('modalBody').innerHTML = `
        <form onsubmit="saveVehicle(event)">
          <div class="form-group">
            <label>Registration Number</label>
            <input type="text" id="vehicleReg" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Vehicle Type</label>
            <input type="text" id="vehicleType" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Max Load (tons)</label>
            <input type="number" id="vehicleMaxLoad" class="form-control" min="0.1" step="0.1" required>
          </div>
          <div class="form-group">
            <label>Insurance Expiry</label>
            <input type="date" id="vehicleInsuranceExpiry" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Inspection Expiry</label>
            <input type="date" id="vehicleInspectionExpiry" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Assigned Driver</label>
            <select id="vehicleDriver" class="form-control">
              <option value="">Unassigned</option>
              <option value="1">John Smith</option>
              <option value="2">Mike Johnson</option>
              <option value="3">Sarah Wilson</option>
            </select>
          </div>
          <div style="text-align: right;">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            <button type="submit" class="btn">Save Vehicle</button>
          </div>
        </form>
      `;
      document.getElementById('modal').style.display = 'flex';
    }

    function openEditVehicleModal(id) {
      // In a real app, this would fetch the vehicle data
      openAddVehicleModal();
      document.getElementById('modalTitle').textContent = 'Edit Vehicle';
      document.getElementById('vehicleReg').value = 'ABC-123';
      document.getElementById('vehicleType').value = 'Truck';
      document.getElementById('vehicleMaxLoad').value = '20';
      document.getElementById('vehicleInsuranceExpiry').value = '2024-06-01';
      document.getElementById('vehicleInspectionExpiry').value = '2024-05-15';
      document.getElementById('vehicleDriver').value = '1';
    }

    function saveVehicle(event) {
      event.preventDefault();
      const reg = document.getElementById('vehicleReg').value;
      const type = document.getElementById('vehicleType').value;
      const maxLoad = document.getElementById('vehicleMaxLoad').value;
      const insuranceExpiry = document.getElementById('vehicleInsuranceExpiry').value;
      const inspectionExpiry = document.getElementById('vehicleInspectionExpiry').value;
      const driver = document.getElementById('vehicleDriver').value;
      
      console.log('Saving vehicle:', { reg, type, maxLoad, insuranceExpiry, inspectionExpiry, driver });
      
      closeModal();
      loadVehicles();
      updateDragArea();
    }

    function deleteVehicle(id) {
      if (confirm('Are you sure you want to delete this vehicle?')) {
        console.log('Deleting vehicle:', id);
        loadVehicles();
        updateDragArea();
      }
    }

    // Card Management
    function loadCardTypes() {
      const cardTypes = ['Fuel Card', 'Toll Card', 'Access Card'];
      
      const cardTypesList = document.getElementById('cardTypesList');
      cardTypesList.innerHTML = cardTypes.map((type, index) => `
        <div class="card-type">
          <div>${type}</div>
          <div class="card-type-actions">
            <button class="btn btn-sm btn-warning" onclick="editCardType(${index}, '${type}')">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-danger" onclick="deleteCardType(${index}, '${type}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      `).join('');
    }

    function addCardType() {
      const newType = document.getElementById('newCardType').value.trim();
      if (!newType) {
        alert('Please enter a card type name');
        return;
      }
      
      console.log('Adding card type:', newType);
      document.getElementById('newCardType').value = '';
      loadCardTypes();
    }

    function editCardType(index, type) {
      const newName = prompt('Edit card type name:', type);
      if (newName && newName.trim()) {
        console.log(`Editing card type ${index} to ${newName}`);
        loadCardTypes();
      }
    }

    function deleteCardType(index, type) {
      if (confirm(`Are you sure you want to delete the "${type}" card type?`)) {
        console.log(`Deleting card type ${index}: ${type}`);
        loadCardTypes();
      }
    }

    // Notification Settings
    function loadNotificationSettings() {
      // In a real app, this would load from storage
      document.getElementById('insuranceNotificationDays').value = 30;
      document.getElementById('inspectionNotificationDays').value = 14;
    }

    function saveNotificationSettings() {
      const insuranceDays = document.getElementById('insuranceNotificationDays').value;
      const inspectionDays = document.getElementById('inspectionNotificationDays').value;
      
      console.log('Saving notification settings:', { insuranceDays, inspectionDays });
      alert('Notification settings saved successfully!');
    }

    // Helper functions
    function formatDate(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
    }

    // Modal functions
    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('modal');
      if (event.target === modal) {
        closeModal();
      }
    }

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeModal();
      }
    });
  </script>
</body>
</html>
